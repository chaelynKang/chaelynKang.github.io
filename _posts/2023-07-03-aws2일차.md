---
layout: single
title: " AWS 2일차 "
categories: keduit
tags: [ AWS, Cloud ]
toc: true 
comments: true
author_profile: true
sidebar:
    nav: "docs"
---


![image](https://github.com/chaelynkang/chaelynkang.github.io/assets/128279031/52ded849-442b-4da0-a511-780d8161369f)

```
표현계층은 nginx, 응용계층으로는 tomcat, 데이터저장으로는 RDS를 사용하여  AWS에서 간단한 3tier 구성을 실습해보았다.
```

---
# 실습

![image](https://github.com/chaelynkang/chaelynkang.github.io/assets/128279031/83f0fd92-fbf8-49c0-9d0b-7c0813042771)

```
`tomcat` 이름의 private-subnet 인스턴스를 생성.
```

![image](https://github.com/chaelynkang/chaelynkang.github.io/assets/128279031/673cfcfa-b39b-43c9-ad1c-35fa903072a9)

```
`tomcat` 인스턴스에 접속하기 위한 `bastion` 이름의 public-subnet 인스턴스를 생성하였다,
`bastion` 인스턴스로 SSH접근 후
sudo -i
vim kedu501.pem 
chmod 600 kedu501.pem
ssh -i kedu501.pem ubuntu@10.10.2.65 // verify
=> 키페어로 tomcat 내부IP로 접근이 가능하다.
```

![image](https://github.com/chaelynkang/chaelynkang.github.io/assets/128279031/04992391-535b-47a2-91b5-616cc89ce92e)

![image](https://github.com/chaelynkang/chaelynkang.github.io/assets/128279031/74324c99-2175-4fb4-b5b2-4bf72c8e2133)
```
NAT gateway 사용을 위해 고정 공인 IP를 할당이 필요하다.
공인 IP 할당 후 Private Subnet에 존재하는 인스턴스의 패키지 설치를 위해 NAT gateway를 생성한다.
생성한 뒤 `vpc-private-rt` 라우팅 테이블을 편집하여 NAT 추가한다.
```

```
# 톰캣 설치

wget https://dlcdn.apache.org/tomcat/tomcat-8/v8.5.90/bin/apache-tomcat-8.5.90.zip
apt update && apt-get -y install openjdk-8-jdk
apt search openjdk // 정확한 패키지명을 모를때 사용한다.
apt remove // 삭제할때 사용한다.
apt -y install unzip
unzip apache-tomcat-8.5.90.zip
rm -rf apache-tomcat-8.5.90.zip
mv apache-tomcat-8.5.90/ tomcat
chmod -R 777 tomcat/
./tomcat/bin/startup.sh
curl localhost:8080 // verify
```

```
# 톰캣 동작 테스트

cd tomcat/webapps/ROOT
vi test.jsp
!
<%@ page contentType="text/html; charset=UTF-8"%>
<html>
    	<head><title>hello world</title></head>
    	<body>
    	<h2>
            	TOMCAT TEST<br><br>
            	time : <%= new java.util.Date()%>
            	<%@ page import="java.net.InetAddress" %><br>
            	<%InetAddress inet= InetAddress.getLocalHost();%>
            	WAS ip : <%=inet.getHostAddress()%>
    	</h2>
 
 
    	</body>
</html>
!
../../bin/shutdown.sh
../../bin/startup.sh
curl localhost:8080/test.jsp // 서버의ip를 보여주는 간단한 jsp 파일로 톰캣이 잘 작동하는 것을 확인.
```

![image](https://github.com/chaelynkang/chaelynkang.github.io/assets/128279031/f07a26cc-8e7d-4a18-b523-2c1c10a56731)

```
https://mvnrepository.com/artifact/mysql/mysql-connector-java/8.0.23
# DB와 연동을 하기위한 JDBC 라이브러리

cd ..
cd ..
cd lib/
wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.23/mysql-connector-java-8.0.23.jar
cd ..
cd webapps/ROOT/
vi dbtest.jsp
!
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.sql.*"%>
<h1>DB</h2>
<%
    	Connection conn=null;
    	try{
            	String Url="jdbc:mysql://<DB주소>/db";  # 엔드포인트/db이름
            	String Id="<DB유저>";                   # 마스터 사용자
            	String Pass="<암호>";                   # 마스터 암호
 
                Class.forName("com.mysql.jdbc.Driver");
                conn=DriverManager.getConnection(Url,Id,Pass);
            	out.println("was-db Connection Success!");
    	}catch(Exception e) {
            	e.printStackTrace();
}
%>
!
../../bin/shutdown.sh
../../bin/startup.sh
curl localhost:8080/dbtest.jsp // connection success!
```

```
# nginx가 설치된 web서버를 앞단에 붙이기 (`bastion` 인스턴스를 사용)

apt update && apt -y install nginx
cd /etc/nginx/sites-available/
cp default default.backup
```
![image](https://github.com/chaelynkang/chaelynkang.github.io/assets/128279031/107d9644-5932-4949-a427-e74f8aee551a)

![image](https://github.com/chaelynkang/chaelynkang.github.io/assets/128279031/12525ac1-9add-4d6a-9fa9-3530a9fd7361)


```
nginx가 설치된 bastion 인스턴스의 외부 엔드포인트로 확인 해보면 db와 tomcat 모두 정상적으로 연동됨을 확인할 수 있다.
```